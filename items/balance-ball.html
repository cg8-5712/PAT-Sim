<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026æ°‘èˆªæ‹›é£PATæ–°é¢˜å‹ - å¹³è¡¡å¯†ç é”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.3);
            text-align: center;
        }

        .header h1 {
            color: white;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header h2 {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: normal;
        }

        .instruction {
            background: #e3f2fd;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #1e88e5;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .instruction h3 {
            color: #1565c0;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .instruction p {
            color: #424242;
            line-height: 1.8;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .instruction ul {
            margin-left: 25px;
            color: #424242;
            line-height: 1.8;
        }

        .game-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        .balance-section, .lock-section {
            background: #fafafa;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .section-title {
            text-align: center;
            color: #1565c0;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .balance-board {
            width: 100%;
            aspect-ratio: 1 / 1;
            background: linear-gradient(135deg, #c17a4a 0%, #a0653f 100%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 4px solid #8b5a3c;
        }

        .ball {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #c92a2a);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.05s ease-out;
        }

        .timer-display {
            text-align: center;
            font-size: 48px;
            font-weight: 700;
            color: #1e88e5;
            margin-bottom: 20px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .password-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .password-digits {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .password-digit {
            font-size: 56px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .lock-wheels {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .wheel {
            background: #455a64;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 3px solid #37474f;
            position: relative;
            overflow: hidden;
        }

        .wheel-container {
            width: 100px;
            height: 280px;
            position: relative;
            overflow: hidden;
            background: #263238;
            border-radius: 8px;
            cursor: grab;
            user-select: none;
            touch-action: none;
        }

        .wheel-container:active {
            cursor: grabbing;
        }

        .wheel-strip {
            position: absolute;
            left: 0;
            width: 100%;
            transition: top 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .wheel-strip.dragging {
            transition: none;
        }

        .wheel-number {
            font-size: 48px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            height: 80px;
            line-height: 80px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: all 0.2s ease;
        }

        .wheel-number.active {
            color: white;
            font-size: 56px;
            transform: scale(1.1);
        }

        .wheel-highlight {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 80px;
            transform: translateY(-50%);
            background: rgba(255, 215, 0, 0.1);
            border-top: 3px solid #ffd700;
            border-bottom: 3px solid #ffd700;
            pointer-events: none;
            z-index: 1;
        }

        .wheel-gradient-top {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to bottom, #263238, transparent);
            pointer-events: none;
            z-index: 2;
        }

        .wheel-gradient-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to top, #263238, transparent);
            pointer-events: none;
            z-index: 2;
        }

        .wheel-touch-controls {
            display: none;
            width: 100%;
            gap: 12px;
            margin-top: 12px;
        }

        .wheel-touch-btn {
            flex: 1;
            padding: 10px 0;
            border: none;
            border-radius: 6px;
            background: #1e88e5;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
            transition: transform 0.1s ease, background 0.2s ease;
        }

        .wheel-touch-btn:active {
            transform: scale(0.96);
        }

        .wheel-touch-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 14px 35px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #1e88e5;
            color: white;
        }

        .btn:hover {
            background: #1565c0;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4);
        }

        .btn-secondary {
            background: #78909c;
        }

        .btn-secondary:hover {
            background: #607d8b;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border: 1px solid #e0e0e0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #fafafa;
            min-width: 120px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e88e5;
        }

        .stat-label {
            font-size: 14px;
            color: #757575;
            margin-top: 8px;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            min-width: 400px;
            text-align: center;
        }

        .result-modal.show {
            display: block;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .modal-overlay.show {
            display: block;
        }

        .result-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .result-title.success {
            color: #4caf50;
        }

        .result-title.fail {
            color: #f44336;
        }

        .result-info {
            font-size: 18px;
            color: #424242;
            margin-bottom: 10px;
        }

        .result-time {
            font-size: 48px;
            font-weight: 700;
            color: #1e88e5;
            margin: 20px 0;
        }

        @media (max-width: 1024px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .header h2 {
                font-size: 16px;
            }

            .password-digit {
                font-size: 40px;
            }

            .wheel-number {
                font-size: 36px;
            }

            .lock-wheels {
                flex-direction: column;
                align-items: center;
            }

            .wheel {
                width: 100%;
                max-width: 240px;
            }

            .wheel-touch-controls {
                display: flex;
            }

            .result-modal {
                min-width: 300px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>2026æ°‘èˆªæ‹›é£PATæ–°é¢˜å‹</h1>
            <h2>å¹³è¡¡å¯†ç é”è®­ç»ƒ</h2>
        </div>

        <div class="instruction">
            <h3>æµ‹è¯•æ–¹æ³•è¯´æ˜</h3>
            <p><strong>æ¸¸æˆç›®æ ‡ï¼š</strong>åœ¨ä¿æŒå·¦ä¾§å°çƒå¹³è¡¡çš„åŒæ—¶ï¼Œè§£å¼€å³ä¾§çš„å¯†ç é”ã€‚</p>
            <ul>
                <li><strong>å·¦ä¾§å¹³è¡¡åŒºï¼š</strong>ä½¿ç”¨é”®ç›˜æ–¹å‘é”®ï¼ˆâ†‘â†“â†â†’ï¼‰æˆ–é¼ æ ‡ç§»åŠ¨ï¼Œæ§åˆ¶å°çƒä¿æŒåœ¨æ£•è‰²åŒºåŸŸå†…</li>
                <li><strong>å³ä¾§å¯†ç é”ï¼š</strong>ç‚¹å‡»æŒ‰é’®è°ƒæ•´æ•°å­—ï¼Œä½¿å…¶ä¸é¡¶éƒ¨æ˜¾ç¤ºçš„å¯†ç ä¸€è‡´</li>
                <li><strong>æ³¨æ„ï¼š</strong>å°çƒç¦»å¼€æ£•è‰²åŒºåŸŸè¶…è¿‡3ç§’ï¼Œæ¸¸æˆå¤±è´¥</li>
                <li><strong>èƒœåˆ©æ¡ä»¶ï¼š</strong>åœ¨æ—¶é—´è€—å°½å‰æˆåŠŸè§£å¼€å¯†ç é”</li>
            </ul>
        </div>

        <div class="game-container">
            <div class="game-area">
                <div class="balance-section">
                    <div class="section-title">ğŸ¯ å¹³è¡¡æ§åˆ¶åŒº</div>
                    <div class="timer-display" id="timer">0ç§’</div>
                    <div class="balance-board" id="balanceBoard">
                        <div class="ball" id="ball"></div>
                    </div>
                </div>

                <div class="lock-section">
                    <div class="section-title">ğŸ” å¯†ç é”</div>
                    <div class="password-display">
                        <div style="color: #757575; margin-bottom: 10px;">ç›®æ ‡å¯†ç ï¼š</div>
                        <div class="password-digits" id="targetPassword"></div>
                    </div>
                    <div class="lock-wheels" id="lockWheels"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                <button class="btn btn-secondary" id="resetBtn">é‡ç½®ç»Ÿè®¡</button>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-item">
                <div class="stat-value" id="gamesPlayed">0</div>
                <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successCount">0</div>
                <div class="stat-label">æˆåŠŸæ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="failCount">0</div>
                <div class="stat-label">å¤±è´¥æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="bestTime">--</div>
                <div class="stat-label">æœ€å¿«çºªå½•</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lastScore">--</div>
                <div class="stat-label">æœ¬æ¬¡å¾—åˆ†</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="result-modal" id="resultModal">
        <div class="result-title" id="resultTitle">æ¸¸æˆç»“æŸ</div>
        <div class="result-info" id="resultInfo"></div>
        <div class="result-score" id="resultScore" style="font-size: 64px; color: #ff9800; font-weight: bold; margin: 10px 0;"></div>
        <div class="result-time" id="resultTime"></div>
        <button class="btn" onclick="closeModal()">ç»§ç»­æ¸¸æˆ</button>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const CONFIG = {
            BALL_SENSITIVITY: 2.5 // å°çƒæ§åˆ¶æ•æ„Ÿåº¦ï¼Œæ•°å€¼è¶Šå¤§è¶Šçµæ•
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            isPlaying: false,
            startTime: 0,
            elapsedTime: 0,
            ballX: 0,
            ballY: 0,
            ballVelX: 0,
            ballVelY: 0,
            totalDeviation: 0,
            frameCount: 0,
            targetPassword: [],
            currentPassword: [],
            outOfBoundsTime: 0,
            stats: {
                gamesPlayed: 0,
                successCount: 0,
                failCount: 0,
                bestTime: null,
                lastScore: null
            }
        };

        let animationFrame;
        let timerInterval;

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const board = document.getElementById('balanceBoard');
            const ball = document.getElementById('ball');
            
            // è®¾ç½®å°çƒåˆå§‹ä½ç½®ï¼ˆä¸­å¿ƒï¼‰
            const boardRect = board.getBoundingClientRect();
            gameState.ballX = boardRect.width / 2 - 20;
            gameState.ballY = boardRect.height / 2 - 20;
            ball.style.left = gameState.ballX + 'px';
            ball.style.top = gameState.ballY + 'px';

            // ç”Ÿæˆéšæœºå¯†ç ï¼ˆ4ä½æ•°å­—ï¼‰
            gameState.targetPassword = [];
            for (let i = 0; i < 4; i++) {
                gameState.targetPassword.push(Math.floor(Math.random() * 10));
            }

            // åˆå§‹åŒ–å½“å‰å¯†ç 
            gameState.currentPassword = [0, 0, 0, 0];

            // æ˜¾ç¤ºç›®æ ‡å¯†ç 
            const targetPasswordDiv = document.getElementById('targetPassword');
            targetPasswordDiv.innerHTML = '';
            gameState.targetPassword.forEach(digit => {
                const span = document.createElement('span');
                span.className = 'password-digit';
                span.textContent = digit;
                targetPasswordDiv.appendChild(span);
            });

            // åˆ›å»ºå¯†ç é”è½®ç›˜
            const lockWheelsDiv = document.getElementById('lockWheels');
            lockWheelsDiv.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const wheel = document.createElement('div');
                wheel.className = 'wheel';
                
                // åˆ›å»ºè½®ç›˜å®¹å™¨
                const container = document.createElement('div');
                container.className = 'wheel-container';
                container.dataset.wheelIndex = i;
                
                // åˆ›å»ºæ•°å­—æ¡å¸¦
                const strip = document.createElement('div');
                strip.className = 'wheel-strip';
                strip.id = `wheelStrip${i}`;
                
                // åˆ›å»ºæ•°å­—ï¼ˆé‡å¤3æ¬¡ï¼Œå½¢æˆå¾ªç¯æ•ˆæœï¼‰
                for (let repeat = 0; repeat < 3; repeat++) {
                    for (let num = 0; num < 10; num++) {
                        const numberDiv = document.createElement('div');
                        numberDiv.className = 'wheel-number';
                        numberDiv.textContent = num;
                        numberDiv.dataset.value = num;
                        strip.appendChild(numberDiv);
                    }
                }
                
                container.appendChild(strip);
                
                // æ·»åŠ é«˜äº®åŒºåŸŸ
                const highlight = document.createElement('div');
                highlight.className = 'wheel-highlight';
                container.appendChild(highlight);
                
                // æ·»åŠ æ¸å˜é®ç½©
                const gradientTop = document.createElement('div');
                gradientTop.className = 'wheel-gradient-top';
                container.appendChild(gradientTop);
                
                const gradientBottom = document.createElement('div');
                gradientBottom.className = 'wheel-gradient-bottom';
                container.appendChild(gradientBottom);
                
                wheel.appendChild(container);
                wheel.appendChild(createWheelTouchControls(i));
                lockWheelsDiv.appendChild(wheel);
                
                // åˆå§‹åŒ–ä½ç½®
                updateWheelPosition(i, 0);
            }
            
            // æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬
            setupWheelListeners();
        }

        // è½®ç›˜æ»šåŠ¨ç›¸å…³å˜é‡
        const wheelStates = [];

        // è®¾ç½®è½®ç›˜ç›‘å¬å™¨
        function setupWheelListeners() {
            const containers = document.querySelectorAll('.wheel-container');
            wheelStates.length = 0;
            
            containers.forEach((container, index) => {
                wheelStates[index] = {
                    startY: 0,
                    currentY: 0,
                    isDragging: false,
                    velocity: 0,
                    lastY: 0,
                    lastTime: 0,
                    pointerId: null
                };

                container.addEventListener('pointerdown', (e) => handlePointerDown(e, index));
                container.addEventListener('pointermove', (e) => handlePointerMove(e, index), { passive: false });
                container.addEventListener('pointerup', (e) => handlePointerUp(e, index));
                container.addEventListener('pointercancel', (e) => handlePointerUp(e, index));

                container.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? 1 : -1;
                    changeWheel(index, delta);
                }, { passive: false });
            });
        }

        // Pointeräº‹ä»¶è®©ç§»åŠ¨ç«¯æ‹–åŠ¨æ›´é¡ºæ»‘
        function handlePointerDown(e, index) {
            if (!gameState.isPlaying) return;
            if (e.pointerType === 'mouse' && e.button !== 0) return;

            const container = e.currentTarget;
            const state = wheelStates[index];
            if (state.isDragging) return;

            state.pointerId = e.pointerId;
            if (e.pointerType !== 'mouse' && e.cancelable) {
                e.preventDefault();
            }
            if (container.setPointerCapture) {
                container.setPointerCapture(e.pointerId);
            }
            startDrag(e, index);
        }

        function handlePointerMove(e, index) {
            const state = wheelStates[index];
            if (!state.isDragging || state.pointerId !== e.pointerId) return;

            if (e.pointerType !== 'mouse' && e.cancelable) {
                e.preventDefault();
            }
            drag(e, index);
        }

        function handlePointerUp(e, index) {
            const state = wheelStates[index];
            if (!state.isDragging || state.pointerId !== e.pointerId) return;

            const container = e.currentTarget;
            if (container.hasPointerCapture && container.hasPointerCapture(e.pointerId)) {
                container.releasePointerCapture(e.pointerId);
            }
            state.pointerId = null;
            endDrag(index);
        }

        // è§¦æ§ç«¯å¤‡ç”¨æŒ‰é’®ï¼Œæ–¹ä¾¿ç²¾ç»†è°ƒæ•´
        function createWheelTouchControls(index) {
            const controls = document.createElement('div');
            controls.className = 'wheel-touch-controls';

            const upBtn = document.createElement('button');
            upBtn.type = 'button';
            upBtn.className = 'wheel-touch-btn';
            upBtn.setAttribute('aria-label', 'å‘ä¸Šè°ƒæ•´æ•°å­—');
            upBtn.textContent = 'â–²';
            upBtn.addEventListener('click', () => changeWheel(index, -1));

            const downBtn = document.createElement('button');
            downBtn.type = 'button';
            downBtn.className = 'wheel-touch-btn';
            downBtn.setAttribute('aria-label', 'å‘ä¸‹è°ƒæ•´æ•°å­—');
            downBtn.textContent = 'â–¼';
            downBtn.addEventListener('click', () => changeWheel(index, 1));

            controls.appendChild(upBtn);
            controls.appendChild(downBtn);
            return controls;
        }

        function startDrag(e, index) {
            if (!gameState.isPlaying) return;
            
            const state = wheelStates[index];
            state.isDragging = true;
            state.startY = e.clientY;
            state.lastY = e.clientY;
            state.lastTime = Date.now();
            state.velocity = 0;
            
            // æ‹–åŠ¨æ—¶ç¦ç”¨è¿‡æ¸¡åŠ¨ç”»
            const strip = document.getElementById(`wheelStrip${index}`);
            strip.classList.add('dragging');
        }

        function drag(e, index) {
            if (!gameState.isPlaying) return;
            
            const state = wheelStates[index];
            if (!state.isDragging) return;
            
            const deltaY = e.clientY - state.lastY;
            const deltaTime = Date.now() - state.lastTime;
            
            state.velocity = deltaY / deltaTime;
            state.lastY = e.clientY;
            state.lastTime = Date.now();
            
            const strip = document.getElementById(`wheelStrip${index}`);
            let currentTop = parseInt(strip.style.top) || 0;
            let newTop = currentTop + deltaY;
            
            // æ— é™æ»šåŠ¨é€»è¾‘ï¼šä¿æŒåœ¨ä¸­é—´åŒºåŸŸ
            // æ¯ä¸€ç»„é«˜åº¦ 800px (10 * 80)
            // ä¸­é—´ç»„å¤§è‡´èŒƒå›´ -700 åˆ° -1420
            // å¦‚æœåç¦»å¤ªè¿œï¼Œç¬é—´è·³è½¬å›ä¸­é—´ç»„
            if (newTop > -300) { // å‘ä¸Šæ»šåŠ¨è¿‡å¤šï¼ˆçœ‹åˆ°ç¬¬ä¸€ç»„ï¼‰
                newTop -= 800;
            } else if (newTop < -1800) { // å‘ä¸‹æ»šåŠ¨è¿‡å¤šï¼ˆçœ‹åˆ°ç¬¬ä¸‰ç»„ï¼‰
                newTop += 800;
            }
            
            // ç›´æ¥è®¾ç½®ä½ç½®
            strip.style.top = newTop + 'px';
            
            // ä»…æ›´æ–°è§†è§‰é«˜äº®ï¼Œä¸å¸é™„
            updateActiveNumberByPosition(index, newTop);
        }

        // æ ¹æ®ä½ç½®æ›´æ–°æ´»åŠ¨æ•°å­—çŠ¶æ€
        function updateActiveNumberByPosition(index, currentTop) {
            const strip = document.getElementById(`wheelStrip${index}`);
            const itemHeight = 80;
            const centerOffset = 100;
            
            // è®¡ç®—å½“å‰ä½ç½®å¯¹åº”çš„æ•°å­—ç´¢å¼• k
            // currentTop = -(k * 80 - 100) => k = (100 - currentTop) / 80
            const k = Math.round((centerOffset - currentTop) / itemHeight);
            const normalizedValue = ((k % 10) + 10) % 10;
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            const numbers = strip.querySelectorAll('.wheel-number');
            numbers.forEach((num, idx) => {
                const numValue = parseInt(num.dataset.value);
                // é«˜äº®æ‰€æœ‰åŒ¹é…å€¼çš„æ•°å­—ï¼Œç¡®ä¿æ»šåŠ¨è¿‡ç¨‹ä¸­è§†è§‰ä¸€è‡´
                if (numValue === normalizedValue) {
                    num.classList.add('active');
                } else {
                    num.classList.remove('active');
                }
            });
        }

        function endDrag(index) {
            const state = wheelStates[index];
            if (!state.isDragging) return;
            
            state.isDragging = false;
            
            // æ‹–åŠ¨ç»“æŸï¼Œå¸é™„åˆ°æœ€è¿‘çš„æ•°å­—
            snapToNearest(index);
        }

        // å¸é™„åˆ°æœ€è¿‘çš„æ•°å­—
        function snapToNearest(index) {
            const strip = document.getElementById(`wheelStrip${index}`);
            const itemHeight = 80;
            const centerOffset = 100;
            
            const currentTop = parseInt(strip.style.top) || 0;
            
            // è®¡ç®—æœ€è¿‘çš„ç´¢å¼• k
            const k = Math.round((centerOffset - currentTop) / itemHeight);
            
            // ç›®æ ‡ä½ç½®
            const targetTop = -(k * itemHeight - centerOffset);
            
            // å¯ç”¨è¿‡æ¸¡åŠ¨ç”»
            strip.classList.remove('dragging');
            strip.style.top = targetTop + 'px';
            
            // æ›´æ–°å¯†ç 
            const normalizedValue = ((k % 10) + 10) % 10;
            gameState.currentPassword[index] = normalizedValue;
            updateActiveNumberByPosition(index, targetTop);
            
            // åŠ¨ç”»ç»“æŸåï¼Œå¦‚æœä¸åœ¨ä¸­é—´ç»„ï¼Œåˆ™é‡ç½®ä½ç½®
            setTimeout(() => {
                const middleK = normalizedValue + 10; // ä¸­é—´ç»„å¯¹åº”çš„ç´¢å¼• (10-19)
                if (k !== middleK) {
                    // ç¬é—´é‡ç½®ä½ç½®
                    strip.classList.add('dragging'); // ç¦ç”¨åŠ¨ç”»
                    strip.offsetHeight; // å¼ºåˆ¶é‡ç»˜
                    const newPos = -(middleK * itemHeight - centerOffset);
                    strip.style.top = newPos + 'px';
                    
                    // ä¸‹ä¸€å¸§ç§»é™¤draggingç±»ï¼Œä»¥ä¾¿ä¸‹æ¬¡äº¤äº’
                    requestAnimationFrame(() => {
                        strip.classList.remove('dragging');
                    });
                }
            }, 300); // ç­‰å¾…CSSè¿‡æ¸¡å®Œæˆ (0.3s)
        }

        // æ›´æ–°è½®ç›˜ä½ç½®ï¼ˆå¸¦è¿‡æ¸¡åŠ¨ç”»ï¼‰
        function updateWheelPosition(index, value) {
            const strip = document.getElementById(`wheelStrip${index}`);
            const itemHeight = 80; // æ¯ä¸ªæ•°å­—çš„é«˜åº¦
            const centerOffset = 100; // ä¸­å¿ƒåç§»é‡
            
            // è®¡ç®—ä½ç½®ï¼ˆåœ¨ç¬¬äºŒç»„æ•°å­—ä¸Šï¼‰
            const position = -(value * itemHeight + 10 * itemHeight - centerOffset);
            strip.style.top = position + 'px';
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            updateActiveNumber(index, value);
        }

        // æ›´æ–°è½®ç›˜ä½ç½®ï¼ˆæ— è¿‡æ¸¡ï¼Œç”¨äºæ‹–åŠ¨ï¼‰
        function updateWheelPositionSmooth(index, value) {
            const strip = document.getElementById(`wheelStrip${index}`);
            const itemHeight = 80; // æ¯ä¸ªæ•°å­—çš„é«˜åº¦
            const centerOffset = 100; // ä¸­å¿ƒåç§»é‡
            
            // è®¡ç®—ä½ç½®ï¼ˆåœ¨ç¬¬äºŒç»„æ•°å­—ä¸Šï¼‰
            const position = -(value * itemHeight + 10 * itemHeight - centerOffset);
            strip.style.top = position + 'px';
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            updateActiveNumber(index, value);
        }

        // æ›´æ–°æ´»åŠ¨æ•°å­—çŠ¶æ€
        function updateActiveNumber(index, value) {
            const strip = document.getElementById(`wheelStrip${index}`);
            const numbers = strip.querySelectorAll('.wheel-number');
            numbers.forEach((num, idx) => {
                const numValue = parseInt(num.dataset.value);
                const isActive = (numValue === value);
                if (isActive) {
                    num.classList.add('active');
                } else {
                    num.classList.remove('active');
                }
            });
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameState.isPlaying) return;

            gameState.isPlaying = true;
            gameState.startTime = Date.now();
            gameState.elapsedTime = 0;
            gameState.outOfBoundsTime = 0;
            gameState.ballVelX = 0;
            gameState.ballVelY = 0;
            gameState.totalDeviation = 0;
            gameState.frameCount = 0;

            document.getElementById('startBtn').disabled = true;
            
            // å¯åŠ¨è®¡æ—¶å™¨
            timerInterval = setInterval(updateTimer, 100);
            
            // å¯åŠ¨æ¸¸æˆå¾ªç¯
            gameLoop();
        }

        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            if (!gameState.isPlaying) return;

            updateBallPhysics();
            checkBallBounds();
            checkWinCondition();

            animationFrame = requestAnimationFrame(gameLoop);
        }

        // æ›´æ–°å°çƒç‰©ç†
        function updateBallPhysics() {
            const board = document.getElementById('balanceBoard');
            const ball = document.getElementById('ball');
            const boardRect = board.getBoundingClientRect();

            // é‡åŠ›å’Œæ‘©æ“¦åŠ›
            const gravity = 0.3;
            const friction = 0.95;

            // åº”ç”¨é€Ÿåº¦
            gameState.ballVelY += gravity;
            gameState.ballX += gameState.ballVelX;
            gameState.ballY += gameState.ballVelY;

            // è¾¹ç•Œç¢°æ’
            if (gameState.ballX < 0) {
                gameState.ballX = 0;
                gameState.ballVelX *= -0.7;
            }
            if (gameState.ballX > boardRect.width - 40) {
                gameState.ballX = boardRect.width - 40;
                gameState.ballVelX *= -0.7;
            }
            if (gameState.ballY < 0) {
                gameState.ballY = 0;
                gameState.ballVelY *= -0.7;
            }
            if (gameState.ballY > boardRect.height - 40) {
                gameState.ballY = boardRect.height - 40;
                gameState.ballVelY *= -0.7;
            }

            // åº”ç”¨æ‘©æ“¦åŠ›
            gameState.ballVelX *= friction;
            gameState.ballVelY *= friction;

            // æ›´æ–°ä½ç½®
            ball.style.left = gameState.ballX + 'px';
            ball.style.top = gameState.ballY + 'px';

            // è®¡ç®—åç§»é‡ (è·ç¦»ä¸­å¿ƒçš„è·ç¦»)
            const centerX = boardRect.width / 2 - 20; // 20 is ball radius
            const centerY = boardRect.height / 2 - 20;
            const dx = gameState.ballX - centerX;
            const dy = gameState.ballY - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            gameState.totalDeviation += distance;
            gameState.frameCount++;
        }

        // æ£€æŸ¥å°çƒè¾¹ç•Œ
        function checkBallBounds() {
            const board = document.getElementById('balanceBoard');
            const boardRect = board.getBoundingClientRect();
            
            const isInBounds = gameState.ballX >= 0 && 
                             gameState.ballX <= boardRect.width - 40 &&
                             gameState.ballY >= 0 && 
                             gameState.ballY <= boardRect.height - 40;

            if (!isInBounds) {
                gameState.outOfBoundsTime += 0.1;
                if (gameState.outOfBoundsTime >= 3) {
                    endGame(false, 'å°çƒå¤±å»å¹³è¡¡è¶…è¿‡3ç§’ï¼');
                }
            } else {
                gameState.outOfBoundsTime = 0;
            }
        }

        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
        function checkWinCondition() {
            const isCorrect = gameState.currentPassword.every((digit, i) => 
                digit === gameState.targetPassword[i]
            );

            if (isCorrect) {
                endGame(true, 'æˆåŠŸè§£å¼€å¯†ç é”ï¼');
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            if (!gameState.isPlaying) return;
            
            gameState.elapsedTime = (Date.now() - gameState.startTime) / 1000;
            document.getElementById('timer').textContent = gameState.elapsedTime.toFixed(1) + 'ç§’';
        }

        // æ”¹å˜è½®ç›˜æ•°å­—
        function changeWheel(index, direction) {
            if (!gameState.isPlaying) return;

            const strip = document.getElementById(`wheelStrip${index}`);
            const itemHeight = 80;
            const centerOffset = 100;
            
            // è·å–å½“å‰ä½ç½®å¯¹åº”çš„ç´¢å¼• k
            let currentTop = parseInt(strip.style.top) || 0;
            let k = Math.round((centerOffset - currentTop) / itemHeight);
            
            // ç›®æ ‡ç´¢å¼•
            let targetK = k + direction;
            
            // åŠ¨ç”»ç§»åŠ¨åˆ°ç›®æ ‡ç´¢å¼•
            const targetTop = -(targetK * itemHeight - centerOffset);
            strip.classList.remove('dragging');
            strip.style.top = targetTop + 'px';
            
            // æ›´æ–°å¯†ç 
            let normalizedValue = ((targetK % 10) + 10) % 10;
            gameState.currentPassword[index] = normalizedValue;
            updateActiveNumberByPosition(index, targetTop);
            
            // åŠ¨ç”»ç»“æŸåé‡ç½®ä½ç½®
            setTimeout(() => {
                const middleK = normalizedValue + 10;
                if (targetK !== middleK) {
                    strip.classList.add('dragging');
                    strip.offsetHeight;
                    const newPos = -(middleK * itemHeight - centerOffset);
                    strip.style.top = newPos + 'px';
                    requestAnimationFrame(() => {
                        strip.classList.remove('dragging');
                    });
                }
            }, 300);
        }

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying) return;

            const force = CONFIG.BALL_SENSITIVITY;
            switch(e.key) {
                case 'ArrowUp':
                    gameState.ballVelY -= force;
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    gameState.ballVelY += force;
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    gameState.ballVelX -= force;
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    gameState.ballVelX += force;
                    e.preventDefault();
                    break;
            }
        });

        // ç»“æŸæ¸¸æˆ
        function endGame(success, message) {
            gameState.isPlaying = false;
            clearInterval(timerInterval);
            cancelAnimationFrame(animationFrame);

            document.getElementById('startBtn').disabled = false;

            // æ›´æ–°ç»Ÿè®¡
            gameState.stats.gamesPlayed++;
            let score = 0;
            let details = null;
            
            if (success) {
                gameState.stats.successCount++;
                if (gameState.stats.bestTime === null || gameState.elapsedTime < gameState.stats.bestTime) {
                    gameState.stats.bestTime = gameState.elapsedTime;
                }
                
                // è®¡ç®—åˆ†æ•°
                // åŸºç¡€åˆ† 100
                // æ—¶é—´æƒ©ç½š: æ¯ç§’ 0.5 åˆ†
                // åç§»æƒ©ç½š: å¹³å‡åç§»åƒç´  * 0.2
                const avgDeviation = gameState.frameCount > 0 ? gameState.totalDeviation / gameState.frameCount : 0;
                const timePenalty = gameState.elapsedTime * 0.5;
                const deviationPenalty = avgDeviation * 0.2;
                
                score = Math.max(0, Math.round(100 - timePenalty - deviationPenalty));
                gameState.stats.lastScore = score;
                
                details = {
                    base: 100,
                    timePenalty: timePenalty,
                    deviationPenalty: deviationPenalty,
                    avgDeviation: avgDeviation
                };
            } else {
                gameState.stats.failCount++;
                gameState.stats.lastScore = 0;
            }
            updateStats();

            // æ˜¾ç¤ºç»“æœ
            showResult(success, message, score, details);
        }

        // æ˜¾ç¤ºç»“æœæ¨¡æ€æ¡†
        function showResult(success, message, score, details) {
            const modal = document.getElementById('resultModal');
            const overlay = document.getElementById('modalOverlay');
            const title = document.getElementById('resultTitle');
            const info = document.getElementById('resultInfo');
            const time = document.getElementById('resultTime');
            const scoreDisplay = document.getElementById('resultScore');

            title.textContent = success ? 'ğŸ‰ æŒ‘æˆ˜æˆåŠŸï¼' : 'âŒ æŒ‘æˆ˜å¤±è´¥';
            title.className = 'result-title ' + (success ? 'success' : 'fail');
            
            // é‡ç½®å†…å®¹
            info.innerHTML = '';
            const msgDiv = document.createElement('div');
            msgDiv.textContent = message;
            info.appendChild(msgDiv);
            
            if (success && details) {
                scoreDisplay.textContent = score + 'åˆ†';
                scoreDisplay.style.display = 'block';
                
                const breakdown = document.createElement('div');
                breakdown.style.cssText = 'text-align: left; font-size: 14px; color: #666; margin-top: 15px; background: #f5f5f5; padding: 15px; border-radius: 8px;';
                breakdown.innerHTML = `
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>åŸºç¡€åˆ†</span> <span>${details.base}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; color:#f44336;">
                        <span>æ—¶é—´æƒ©ç½š (${gameState.elapsedTime.toFixed(1)}s Ã— 0.5)</span> 
                        <span>-${details.timePenalty.toFixed(1)}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; color:#f44336;">
                        <span>åç§»æƒ©ç½š (å¹³å‡${details.avgDeviation.toFixed(1)}px Ã— 0.2)</span> 
                        <span>-${details.deviationPenalty.toFixed(1)}</span>
                    </div>
                    <div style="border-top:1px solid #ddd; margin-top:10px; padding-top:10px; display:flex; justify-content:space-between; font-weight:bold; color:#333;">
                        <span>æœ€ç»ˆå¾—åˆ†</span> <span>${score}</span>
                    </div>
                `;
                info.appendChild(breakdown);
            } else {
                scoreDisplay.style.display = 'none';
            }
            
            time.textContent = 'ç”¨æ—¶: ' + gameState.elapsedTime.toFixed(2) + ' ç§’';

            modal.classList.add('show');
            overlay.classList.add('show');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('resultModal').classList.remove('show');
            document.getElementById('modalOverlay').classList.remove('show');
            initGame();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('gamesPlayed').textContent = gameState.stats.gamesPlayed;
            document.getElementById('successCount').textContent = gameState.stats.successCount;
            document.getElementById('failCount').textContent = gameState.stats.failCount;
            document.getElementById('bestTime').textContent = 
                gameState.stats.bestTime !== null ? gameState.stats.bestTime.toFixed(2) + 'ç§’' : '--';
            document.getElementById('lastScore').textContent = 
                gameState.stats.lastScore !== null ? gameState.stats.lastScore : '--';
        }

        // é‡ç½®ç»Ÿè®¡
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ')) {
                gameState.stats = {
                    gamesPlayed: 0,
                    successCount: 0,
                    failCount: 0,
                    bestTime: null,
                    lastScore: null
                };
                updateStats();
            }
        });

        // å¼€å§‹æŒ‰é’®
        document.getElementById('startBtn').addEventListener('click', startGame);

        // åˆå§‹åŒ–
        initGame();
        updateStats();
    </script>
</body>
</html>
