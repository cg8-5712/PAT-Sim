<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-back æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        header {
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.3);
        }
        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }
        .instructions {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #1e88e5;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .instructions h2 {
            color: #1565c0;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }
        .instructions p {
            line-height: 1.8;
            margin-bottom: 10px;
            color: #424242;
            font-size: 15px;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        .controls label {
            font-weight: bold;
            white-space: nowrap;
        }
        .controls input {
            padding: 10px;
            font-size: 16px;
            width: 80px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .controls input:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }
        .controls button {
            flex: 1;
            padding: 14px 35px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #1e88e5;
            color: white;
        }
        .controls button:hover:not(:disabled) {
            background-color: #1565c0;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-label {
            font-size: 14px;
            color: #757575;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e88e5;
        }
        #test-area {
            text-align: center;
            margin-bottom: 20px;
        }
        #current-item {
            font-size: 64px;
            font-weight: 700;
            color: #1e88e5;
            margin: 50px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e3f2fd;
            border-radius: 12px;
            border: 3px solid #bbdefb;
        }
        #test-area button {
            background-color: #1e88e5;
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #test-area button:hover {
            background-color: #1565c0;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4);
        }
        #input-area {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        #input-area label {
            font-weight: bold;
        }
        #input-area input {
            padding: 12px;
            font-size: 20px;
            width: 100px;
            text-align: center;
            border: 2px solid #1e88e5;
            border-radius: 8px;
            font-weight: 600;
        }
        #input-area input:focus {
            outline: none;
            border-color: #1565c0;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
        }
        #input-area button {
            background-color: #1e88e5;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #input-area button:hover {
            background-color: #1565c0;
            box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4);
        }
        .result {
            margin-top: 20px;
            padding: 25px;
            background-color: #e3f2fd;
            border: 2px solid #bbdefb;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        .result h2 {
            color: #1565c0;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 600;
        }
        .result p {
            margin-bottom: 12px;
            line-height: 1.8;
            color: #424242;
        }
        .result-score {
            font-size: 24px;
            font-weight: 700;
            color: #1e88e5;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header>
        <h1>N-back æµ‹è¯•</h1>
        <p>è®°å¿†ä¸æ³¨æ„åŠ›è®­ç»ƒ</p>
    </header>
    <div class="container">
        <div class="instructions">
            <h2>æµ‹è¯•è¯´æ˜</h2>
            <p>å±å¹•ä¸Šä¼šä¾æ¬¡æ˜¾ç¤ºä¸€ç³»åˆ—å­—æ¯æˆ–æ•°å­—ï¼Œè¯·è®°ä½æ¯ä¸ªå­—ç¬¦ã€‚</p>
            <p>å½“éœ€è¦è¾“å…¥æ—¶ï¼Œè¯·è¾“å…¥å½“å‰å­—ç¬¦<strong>å‰Nä¸ªä½ç½®</strong>çš„å­—ç¬¦ã€‚</p>
            <p>ä¾‹å¦‚ï¼šN=2æ—¶ï¼Œå½“å‰æ˜¾ç¤ºç¬¬5ä¸ªå­—ç¬¦ï¼Œä½ éœ€è¦è¾“å…¥ç¬¬3ä¸ªå­—ç¬¦ã€‚</p>
        </div>

        <div class="controls">
            <label for="n-value">N å€¼è®¾ç½®:</label>
            <input type="number" id="n-value" min="1" max="15" value="2">
            <button onclick="startTest()">å¼€å§‹æµ‹è¯•</button>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-label">å½“å‰ä½ç½®</div>
                <div class="stat-value" id="currentIndex">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">åºåˆ—é•¿åº¦</div>
                <div class="stat-value" id="totalLength">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">å·²è¾“å…¥</div>
                <div class="stat-value" id="inputCount">0</div>
            </div>
        </div>

        <div id="test-area" style="display: none;">
            <div id="current-item"></div>
            <button onclick="nextItem()">ä¸‹ä¸€ä¸ª</button>
            <div id="input-area" style="display: none;">
                <label for="user-input">è¾“å…¥å‰Nä¸ªå­—ç¬¦:</label>
                <input type="text" id="user-input" maxlength="1">
                <button onclick="submitInput()">æäº¤</button>
            </div>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        let sequence = [];
        let userInputs = [];
        let currentIndex = 0;
        let n = 2;

        function generateSequence() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
            const length = Math.floor(Math.random() * 4) + 12; // 12-15
            sequence = Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]);
        }

        function startTest() {
            n = parseInt(document.getElementById('n-value').value, 10);
            if (n < 1 || n > 15) {
                alert('è¯·è¾“å…¥1-15ä¹‹é—´çš„Nå€¼');
                return;
            }

            generateSequence();
            currentIndex = 0;
            userInputs = [];

            document.getElementById('test-area').style.display = 'block';
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('result').style.display = 'none';
            document.getElementById('input-area').style.display = 'none';

            updateStats();
            showItem();
        }

        function updateStats() {
            document.getElementById('currentIndex').textContent = currentIndex + 1;
            document.getElementById('totalLength').textContent = sequence.length;
            document.getElementById('inputCount').textContent = userInputs.length;
        }

        function showItem() {
            document.getElementById('current-item').textContent = sequence[currentIndex];
        }

        function nextItem() {
            if (currentIndex >= sequence.length - 1) {
                endTest();
                return;
            }

            currentIndex++;

            if (currentIndex >= n) {
                document.getElementById('input-area').style.display = 'flex';
                document.getElementById('user-input').focus();
            } else {
                document.getElementById('input-area').style.display = 'none';
            }

            updateStats();
            showItem();
        }

        function submitInput() {
            const input = document.getElementById('user-input').value.toUpperCase();

            if (input === '') {
                alert('è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦');
                return;
            }

            userInputs.push(input);
            document.getElementById('user-input').value = '';

            if (currentIndex >= sequence.length - 1) {
                endTest();
            } else {
                currentIndex++;
                updateStats();
                showItem();
                document.getElementById('user-input').focus();
            }
        }

        function endTest() {
            document.getElementById('test-area').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';

            const score = calculateScore();
            const maxScore = sequence.length - n;
            const accuracy = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0;

            let feedback = '';
            if (accuracy >= 90) {
                feedback = 'ğŸ‰ ä¼˜ç§€ï¼è®°å¿†åŠ›è¶…ç¾¤ï¼';
            } else if (accuracy >= 75) {
                feedback = 'ğŸ‘ è‰¯å¥½ï¼ç»§ç»­ä¿æŒï¼';
            } else if (accuracy >= 60) {
                feedback = 'ğŸ’ª åŠæ ¼ï¼è¿˜éœ€åŠ å¼ºç»ƒä¹ ï¼';
            } else {
                feedback = 'ğŸ“š å¤šåŠ ç»ƒä¹ ï¼Œç›¸ä¿¡ä½ ä¼šè¿›æ­¥ï¼';
            }

            resultDiv.innerHTML = `
                <h2>æµ‹è¯•ç»“æœ</h2>
                <p><strong>åŸå§‹åºåˆ—:</strong> ${sequence.join(' ')}</p>
                <p><strong>ä½ çš„è¾“å…¥:</strong> ${userInputs.join(' ')}</p>
                <p><strong>æ­£ç¡®ç­”æ¡ˆ:</strong> ${sequence.slice(0, maxScore).join(' ')}</p>
                <p class="result-score">æˆç»©: ${score} / ${maxScore} (æ­£ç¡®ç‡: ${accuracy}%)</p>
                <p style="margin-top: 15px; font-size: 18px;">${feedback}</p>
            `;
        }

        function calculateScore() {
            let score = 0;
            for (let i = 0; i < userInputs.length && i < sequence.length - n; i++) {
                if (userInputs[i] === sequence[i]) {
                    score++;
                }
            }
            return score;
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            const inputArea = document.getElementById('input-area');
            const userInput = document.getElementById('user-input');

            if (inputArea.style.display === 'flex' && e.key === 'Enter') {
                if (document.activeElement === userInput) {
                    submitInput();
                }
            }
        });
    </script>
</body>
</html>